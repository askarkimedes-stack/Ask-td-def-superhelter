<!DOCTYPE html>
<html lang="no">
<head>
    <meta charset="UTF-8">
    <title>Superhelt Tower Defense</title>

    <style>
        body {
            background: #111;
            color: white;
            font-family: Arial, sans-serif;
            text-align: center;
        }

        h1 {
            margin-top: 10px;
        }

        #ui {
            margin-bottom: 10px;
        }

        canvas {
            background: #222;
            border: 2px solid #555;
            cursor: pointer;
        }

        .info {
            margin: 5px;
        }
    </style>
</head>
<body>

<h1>ü¶∏ Superhelt Tower Defense</h1>

<div id="ui">
    <span class="info">‚ù§Ô∏è Liv: <span id="lives">10</span></span>
    <span class="info">üí∞ Penger: <span id="money">100</span></span>
    <span class="info">Klikk for √• plassere en helt (50üí∞)</span>
</div>

<canvas id="game" width="800" height="400"></canvas>

<script>
    const canvas = document.getElementById("game");
    const ctx = canvas.getContext("2d");

    let lives = 10;
    let money = 100;

    const towers = [];
    const enemies = [];
    const bullets = [];

    const pathY = 200;

    class Enemy {
        constructor() {
            this.x = 0;
            this.y = pathY;
            this.hp = 3;
            this.speed = 1;
        }

        update() {
            this.x += this.speed;
            if (this.x > canvas.width) {
                lives--;
                updateUI();
                return false;
            }
            return this.hp > 0;
        }

        draw() {
            ctx.fillStyle = "red";
            ctx.fillRect(this.x, this.y - 10, 20, 20);
        }
    }

    class Tower {
        constructor(x, y) {
            this.x = x;
            this.y = y;
            this.range = 100;
            this.cooldown = 0;
        }

        update() {
            if (this.cooldown > 0) {
                this.cooldown--;
                return;
            }

            const target = enemies.find(e =>
                Math.hypot(e.x - this.x, e.y - this.y) < this.range
            );

            if (target) {
                bullets.push(new Bullet(this.x, this.y, target));
                this.cooldown = 30;
            }
        }

        draw() {
            ctx.fillStyle = "cyan";
            ctx.beginPath();
            ctx.arc(this.x, this.y, 12, 0, Math.PI * 2);
            ctx.fill();
        }
    }

    class Bullet {
        constructor(x, y, target) {
            this.x = x;
            this.y = y;
            this.target = target;
            this.speed = 4;
        }

        update() {
            const dx = this.target.x - this.x;
            const dy = this.target.y - this.y;
            const dist = Math.hypot(dx, dy);

            if (dist < 5) {
                this.target.hp--;
                return false;
            }

            this.x += (dx / dist) * this.speed;
            this.y += (dy / dist) * this.speed;
            return true;
        }

        draw() {
            ctx.fillStyle = "yellow";
            ctx.fillRect(this.x, this.y, 4, 4);
        }
    }

    function spawnEnemy() {
        enemies.push(new Enemy());
    }

    canvas.addEventListener("click", (e) => {
        if (money < 50) return;

        const rect = canvas.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;

        towers.push(new Tower(x, y));
        money -= 50;
        updateUI();
    });

    function updateUI() {
        document.getElementById("lives").textContent = lives;
        document.getElementById("money").textContent = money;
    }

    function gameLoop() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // Path
        ctx.strokeStyle = "#555";
        ctx.beginPath();
        ctx.moveTo(0, pathY);
        ctx.lineTo(canvas.width, pathY);
        ctx.stroke();

        enemies.forEach((e, i) => {
            if (!e.update()) enemies.splice(i, 1);
            e.draw();
        });

        towers.forEach(t => {
            t.update();
            t.draw();
        });

        bullets.forEach((b, i) => {
            if (!b.update()) bullets.splice(i, 1);
            b.draw();
        });

        if (lives <= 0) {
            ctx.fillStyle = "white";
            ctx.font = "40px Arial";
            ctx.fillText("GAME OVER", 300, 200);
            return;
        }

        requestAnimationFrame(gameLoop);
    }

    setInterval(spawnEnemy, 2000);
    gameLoop();
</script>

</body>
</html>
